<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Calculator - Nigeria Tax Act 2025</title>
    
    <!-- EmailJS Library -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <!-- Paystack Inline Script -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #718096;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .modal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .success-box {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: #155724;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üíº Tax Calculator</h1>
        <p class="subtitle">Nigeria Tax Calculator | Test Payment Integration</p>
        
        <div id="landingPage">
            <div style="text-align: center; padding: 25px; background: #f7fafc; border-radius: 10px; margin-bottom: 30px;">
                <h2 style="color: #2d3748; margin-bottom: 15px;">Choose Your Plan</h2>
                <p style="color: #718096; font-size: 15px;">Select the option that works best for you</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                
                <!-- Plan 1: Free -->
                <div style="background: white; border: 3px solid #e2e8f0; padding: 25px; border-radius: 15px;">
                    <div style="background: #e2e8f0; color: #4a5568; padding: 8px 16px; border-radius: 20px; display: inline-block; font-size: 12px; font-weight: bold; margin-bottom: 15px;">
                        FREE
                    </div>
                    <h3 style="margin-bottom: 10px; font-size: 20px; color: #2d3748;">Manual Entry</h3>
                    <div style="font-size: 32px; font-weight: bold; color: #2d3748; margin: 15px 0;">‚Ç¶0</div>
                    <p style="color: #718096; font-size: 13px; margin-bottom: 20px;">Perfect for simple calculations</p>
                    
                    <div style="margin: 20px 0;">
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Enter figures manually</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Full tax calculation</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Old & new tax laws</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Form A/CIT output</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Email results</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #cbd5e0;">‚úó Bank statement upload</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #cbd5e0;">‚úó AI categorization</div>
                    </div>
                    
                    <button onclick="selectFreePlan()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-weight: bold; font-size: 14px; cursor: pointer; width: 100%; margin-top: 15px;">
                        Get Started Free
                    </button>
                </div>

                <!-- Plan 2: Basic -->
                <div style="background: white; border: 3px solid #ff9800; padding: 25px; border-radius: 15px; transform: scale(1.05); box-shadow: 0 8px 24px rgba(255, 152, 0, 0.2);">
                    <div style="background: #ff9800; color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; font-size: 12px; font-weight: bold; margin-bottom: 15px;">
                        RECOMMENDED
                    </div>
                    <h3 style="margin-bottom: 10px; font-size: 20px; color: #2d3748;">Basic Plan</h3>
                    <div style="font-size: 32px; font-weight: bold; color: #ff9800; margin: 15px 0;">‚Ç¶500</div>
                    <p style="color: #718096; font-size: 13px; margin-bottom: 20px;">Pay per upload (one-time)</p>
                    
                    <div style="margin: 20px 0;">
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Everything in Free plan</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì <strong>ONE bank statement upload</strong></div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì AI auto-categorization</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Tax optimization tips</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #4a5568;">‚úì Duplicate detection</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #cbd5e0;">‚úó Multi-bank compilation</div>
                        <div style="font-size: 13px; margin: 8px 0; color: #cbd5e0;">‚úó Unlimited uploads</div>
                    </div>
                    
                    <button onclick="selectBasicPlan()" style="background: #ff9800; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-weight: bold; font-size: 14px; cursor: pointer; width: 100%; margin-top: 15px;">
                        Pay ‚Ç¶500 Per Upload
                    </button>
                    <div style="text-align: center; margin-top: 10px; font-size: 11px; color: #718096;">
                        Try once, upgrade anytime
                    </div>
                </div>

                <!-- Plan 3: Pro -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; color: white;">
                    <div style="background: rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; font-size: 12px; font-weight: bold; margin-bottom: 15px;">
                        BEST VALUE
                    </div>
                    <h3 style="margin-bottom: 10px; font-size: 20px;">Pro Plan</h3>
                    <div style="font-size: 32px; font-weight: bold; margin: 15px 0;">‚Ç¶3,000</div>
                    <p style="opacity: 0.9; font-size: 13px; margin-bottom: 20px;">Full year unlimited access</p>
                    
                    <div style="margin: 20px 0;">
                        <div style="font-size: 13px; margin: 8px 0;">‚úì Everything in Basic plan</div>
                        <div style="font-size: 13px; margin: 8px 0;">‚úì <strong>UNLIMITED uploads</strong></div>
                        <div style="font-size: 13px; margin: 8px 0;">‚úì Multi-bank compilation</div>
                        <div style="font-size: 13px; margin: 8px 0;">‚úì Advanced optimization</div>
                        <div style="font-size: 13px; margin: 8px 0;">‚úì Inter-bank transfers</div>
                        <div style="font-size: 13px; margin: 8px 0;">‚úì Priority support</div>
                        <div style="font-size: 13px; margin: 8px 0;">‚úì Valid entire tax year</div>
                    </div>
                    
                    <button onclick="selectProPlan()" style="background: white; color: #667eea; border: none; padding: 12px 24px; border-radius: 25px; font-weight: bold; font-size: 14px; cursor: pointer; width: 100%; margin-top: 15px;">
                        Get Pro (Best Deal)
                    </button>
                    <div style="text-align: center; margin-top: 10px; font-size: 11px; opacity: 0.9;">
                        Save 83% vs 6 Basic uploads
                    </div>
                </div>
            </div>

            <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 10px;">
                <p style="margin: 0; color: #4a5568; font-size: 14px;">
                    <strong>üí° Not sure?</strong> Start with the <strong>Free plan</strong> to try it out, or pay <strong>‚Ç¶500 once</strong> to test AI-powered analysis. Upgrade to <strong>Pro</strong> anytime for unlimited uploads!
                </p>
            </div>
        </div>

        <!-- PAYMENT MODAL -->
        <div class="modal" id="paymentModal">
            <div class="modal-content">
                <h2 id="paymentModalTitle">üí≥ Complete Your Payment</h2>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;" id="paymentSummary">
                    <!-- Dynamic content -->
                </div>

                <div class="form-group">
                    <label for="paymentEmail"><strong>Email Address</strong></label>
                    <input type="email" id="paymentEmail" placeholder="your.email@example.com" required>
                </div>

                <div class="form-group">
                    <label for="paymentName"><strong>Full Name</strong></label>
                    <input type="text" id="paymentName" placeholder="John Doe" required>
                </div>

                <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                    <p style="margin: 0; font-size: 13px; color: #e65100;">
                        <strong>üîí Secure Payment:</strong> You'll be redirected to Paystack to complete your payment securely.
                    </p>
                </div>

                <button class="modal-btn primary" id="proceedToPayment">
                    Proceed to Payment
                </button>
                
                <button class="modal-btn secondary" id="cancelPayment">
                    Cancel
                </button>

                <div id="paymentSuccess" class="success-box" style="display: none;">
                    ‚úì Payment Successful!<br>
                    <small id="successMessage"></small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - REPLACE THESE VALUES
        // ============================================
        const EMAILJS_PUBLIC_KEY = "sWO_9sQmBOTAFrAIN";
        const EMAILJS_SERVICE_ID = "service_5kor83g";
        const EMAILJS_TEMPLATE_ID = "template_nvq6j4d";
        const PAYSTACK_PUBLIC_KEY = "pk_test_REPLACE_WITH_YOUR_PAYSTACK_PUBLIC_KEY";
        
        // Initialize EmailJS
        (function(){
            emailjs.init(EMAILJS_PUBLIC_KEY);
        })();
        
        let selectedPaymentPlan = null;
        let userPlan = 'free';

        // Plan selection handlers
        function selectFreePlan() {
            userPlan = 'free';
            document.getElementById('landingPage').innerHTML = '<div class="success-box">‚úì Free plan activated! You can now use manual tax calculations.</div>';
            console.log('Free plan selected');
        }

        function selectBasicPlan() {
            selectedPaymentPlan = 'basic';
            showPaymentModal('basic');
        }

        function selectProPlan() {
            selectedPaymentPlan = 'pro';
            showPaymentModal('pro');
        }

        function showPaymentModal(plan) {
            const modal = document.getElementById('paymentModal');
            const summaryDiv = document.getElementById('paymentSummary');
            const btn = document.getElementById('proceedToPayment');
            
            if (plan === 'basic') {
                summaryDiv.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: #ff9800;">‚Ç¶500</div>
                        <div style="font-size: 14px; color: #e65100; margin-top: 5px;">Pay per upload (one-time)</div>
                    </div>
                `;
                btn.textContent = 'Pay ‚Ç¶500 - One Upload';
            } else if (plan === 'pro') {
                summaryDiv.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: #667eea;">‚Ç¶3,000</div>
                        <div style="font-size: 14px; color: #5e35b1; margin-top: 5px;">Full year unlimited access</div>
                    </div>
                `;
                btn.textContent = 'Pay ‚Ç¶3,000 - Get Pro';
            }
            
            modal.classList.add('active');
        }

        // Payment modal handlers
        document.getElementById('cancelPayment').addEventListener('click', function() {
            document.getElementById('paymentModal').classList.remove('active');
            document.getElementById('paymentSuccess').style.display = 'none';
        });

        document.getElementById('proceedToPayment').addEventListener('click', async function() {
            const email = document.getElementById('paymentEmail').value.trim();
            const name = document.getElementById('paymentName').value.trim();

            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }

            if (!name) {
                alert('Please enter your full name');
                return;
            }

            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Processing...';

            try {
                await initiatePaystackPayment(email, name);
            } catch (error) {
                alert('Payment initialization failed. Please try again.');
                console.error('Payment error:', error);
                btn.disabled = false;
                btn.textContent = selectedPaymentPlan === 'basic' ? 'Pay ‚Ç¶500 - One Upload' : 'Pay ‚Ç¶3,000 - Get Pro';
            }
        });

        async function initiatePaystackPayment(email, name) {
            // Check if Paystack is configured
            if (PAYSTACK_PUBLIC_KEY === 'pk_live_f70276598a8a43ddcae6a3eb2b219d704d463662') {
                alert('‚ö†Ô∏è Paystack is not configured yet!\n\nPlease add your Paystack public key to the PAYSTACK_PUBLIC_KEY variable.\n\nSee SETUP_PAYSTACK.md for instructions.');
                throw new Error('Paystack not configured');
            }

            // Calculate amount based on selected plan
            let amount, planName;
            if (selectedPaymentPlan === 'basic') {
                amount = 50000; // ‚Ç¶500 in kobo
                planName = 'Basic Plan (‚Ç¶500)';
            } else if (selectedPaymentPlan === 'pro') {
                amount = 300000; // ‚Ç¶3,000 in kobo
                planName = 'Pro Plan (‚Ç¶3,000)';
            } else {
                alert('Please select a payment plan');
                throw new Error('No plan selected');
            }

            console.log('Initiating payment:', { plan: selectedPaymentPlan, amount: amount/100, email, name });

            // Initialize Paystack payment
            const handler = PaystackPop.setup({
                key: PAYSTACK_PUBLIC_KEY,
                email: email,
                amount: amount,
                currency: 'NGN',
                ref: 'TAX_' + selectedPaymentPlan.toUpperCase() + '_' + Math.floor(Math.random() * 1000000000) + '_' + Date.now(),
                metadata: {
                    custom_fields: [
                        {
                            display_name: "Customer Name",
                            variable_name: "customer_name",
                            value: name
                        },
                        {
                            display_name: "Plan",
                            variable_name: "plan",
                            value: planName
                        }
                    ]
                },
                callback: function(response) {
                    console.log('Payment successful!', response);
                    handleSuccessfulPayment(response.reference, email, name, selectedPaymentPlan, amount);
                },
                onClose: function() {
                    console.log('Payment modal closed by user');
                    document.getElementById('proceedToPayment').disabled = false;
                    document.getElementById('proceedToPayment').textContent = 
                        selectedPaymentPlan === 'basic' ? 'Pay ‚Ç¶500 - One Upload' : 'Pay ‚Ç¶3,000 - Get Pro';
                }
            });

            handler.openIframe();
        }

        function handleSuccessfulPayment(reference, email, name, plan, amount) {
            // Save payment record to localStorage
            const paymentRecord = {
                reference: reference,
                email: email,
                name: name,
                plan: plan,
                amount: amount / 100, // Convert kobo to naira
                date: new Date().toISOString(),
                status: 'paid'
            };

            const payments = localStorage.getItem('taxPayments');
            const allPayments = payments ? JSON.parse(payments) : {};
            
            if (!allPayments[email.toLowerCase()]) {
                allPayments[email.toLowerCase()] = [];
            }
            
            allPayments[email.toLowerCase()].push(paymentRecord);
            localStorage.setItem('taxPayments', JSON.stringify(allPayments));

            // Update user plan
            userPlan = plan;

            // Show success message
            const successDiv = document.getElementById('paymentSuccess');
            const successMsg = document.getElementById('successMessage');
            
            successMsg.innerHTML = `
                Reference: <strong>${reference}</strong><br>
                Plan: <strong>${plan === 'basic' ? 'Basic (‚Ç¶500)' : 'Pro (‚Ç¶3,000)'}</strong><br>
                Email: <strong>${email}</strong>
            `;
            
            successDiv.style.display = 'block';

            // Send confirmation email
            sendPaymentConfirmationEmail(email, name, plan, amount / 100, reference);

            // Hide payment button
            document.getElementById('proceedToPayment').style.display = 'none';

            console.log('Payment recorded:', paymentRecord);
        }

        async function sendPaymentConfirmationEmail(email, name, plan, amount, reference) {
            if (EMAILJS_PUBLIC_KEY === 'YOUR_PUBLIC_KEY_HERE') {
                console.log('EmailJS not configured, skipping email send');
                return;
            }

            const emailParams = {
                to_name: name,
                to_email: email,
                from_email: 'noreply@taxcalculator.com',
                user_email: email,
                tax_type: `Payment Confirmation - ${plan === 'basic' ? 'Basic Plan' : 'Pro Plan'}`,
                calculation_details: `
PAYMENT CONFIRMATION
================================================================================
Thank you for your payment!

Payment Reference: ${reference}
Plan: ${plan === 'basic' ? 'Basic Plan - One Upload' : 'Pro Plan - Unlimited Access'}
Amount Paid: ‚Ç¶${amount.toLocaleString()}
Date: ${new Date().toLocaleString('en-NG')}

${plan === 'basic' ? 
  'You can now upload ONE bank statement for AI-powered analysis.' :
  'You now have UNLIMITED uploads for the entire tax year!'}

Next Steps:
1. You can now access the AI-powered bank statement analyzer
2. Upload your bank statements and let AI categorize transactions
3. Get professional tax returns ready for filing

Questions? Reply to this email.

Thank you for choosing our service!
================================================================================
                `,
                timestamp: new Date().toLocaleString('en-NG'),
                reply_to: 'kwadonzeh@gmail.com'
            };

            try {
                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, emailParams);
                console.log('Confirmation email sent to:', email);
            } catch (error) {
                console.error('Failed to send confirmation email:', error);
            }
        }

        // Log configuration status on load
        window.addEventListener('load', function() {
            console.log('=== Tax Calculator Configuration Status ===');
            console.log('EmailJS Public Key:', EMAILJS_PUBLIC_KEY === 'YOUR_PUBLIC_KEY_HERE' ? '‚ùå NOT CONFIGURED' : '‚úì Configured');
            console.log('EmailJS Service ID:', EMAILJS_SERVICE_ID === 'YOUR_SERVICE_ID_HERE' ? '‚ùå NOT CONFIGURED' : '‚úì Configured');
            console.log('EmailJS Template ID:', EMAILJS_TEMPLATE_ID === 'YOUR_TEMPLATE_ID_HERE' ? '‚ùå NOT CONFIGURED' : '‚úì Configured');
            console.log('Paystack Public Key:', PAYSTACK_PUBLIC_KEY === 'pk_test_REPLACE_WITH_YOUR_PAYSTACK_PUBLIC_KEY' ? '‚ùå NOT CONFIGURED' : '‚úì Configured');
            console.log('===========================================');
            
            if (PAYSTACK_PUBLIC_KEY === 'pk_test_REPLACE_WITH_YOUR_PAYSTACK_PUBLIC_KEY') {
                console.warn('‚ö†Ô∏è Paystack not configured! Payments will not work until you add your API key.');
                console.log('üìñ See SETUP_PAYSTACK.md for setup instructions');
            }
            
            if (EMAILJS_PUBLIC_KEY === 'YOUR_PUBLIC_KEY_HERE') {
                console.warn('‚ö†Ô∏è EmailJS not configured! Email sending will not work until you add your API keys.');
                console.log('üìñ See SETUP_EMAILJS.md for setup instructions');
            }
        });
    </script>
</body>
</html>